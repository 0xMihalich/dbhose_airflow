PGCopyReader
============

.. py:class:: PGCopyReader(file, pgtypes=[])

   :param file: Файловый объект с бинарными данными PGCOPY
   :type file: BufferedReader
   :param pgtypes: Список OID типов данных колонок (опционально)
   :type pgtypes: list[PGOid]

   Основной класс для чтения бинарного формата PGCOPY.

**Описание:**

Парсит заголовок и данные бинарного формата PostgreSQL COPY, предоставляя
интерфейс для построчного чтения данных. Поддерживает автоматическое определение
типов данных или чтение сырых байтов.

**Алгоритм работы:**

1. Проверка сигнатуры файла (``PGCOPY\n\xff\r\n\x00``)
2. Чтение флагов и заголовка
3. Определение количества колонок
4. Инициализация функций чтения для типов данных
5. Последовательное чтение записей

**Атрибуты:**

.. py:attribute:: num_columns
   :type: int

   Количество колонок в данных.

.. py:attribute:: num_rows
   :type: int

   Количество строк в данных.

.. py:attribute:: postgres_dtype
   :type: list[PostgreSQLDtype]

   Список типов данных для каждой колонки.

.. py:attribute:: is_oid_enable
   :type: bool

   Флаг включения OID в заголовке.

**Методы:**

.. py:method:: read_row()

   :return: Генератор значений одной строки
   :rtype: Generator[Any, None, None]

   Чтение одной строки данных построчно по колонкам.

.. py:method:: to_rows()

   :return: Генератор списков строк
   :rtype: Generator[list[Any], None, None]

   Чтение всех строк данных.

.. py:method:: tell()

   :return: Текущая позиция в файле
   :rtype: int

   Получение позиции чтения.

.. py:method:: close()

   Закрытие файлового объекта.

**Строковое представление:**

При выводе в консоли показывает таблицу с информацией о колонках:

.. code-block:: text

    <PGCopy dump reader>
    ┌─────────────────┬─────────────────┐
    │ Column Number   │ PostgreSQL Type │
    ╞═════════════════╪═════════════════╡
    │ Column_0        │ int4            │
    ├─────────────────┼─────────────────┤
    │ Column_1        │ text            │
    └─────────────────┴─────────────────┘
    Total columns: 2
    Total rows: 1000

**Особенности:**

- Автоматическая обработка заголовка бинарного формата
- Поддержка как типизированного, так и сырого чтения
- Потоковое чтение больших объемов данных
- Корректная обработка массивов и сложных типов

**Использование:**

Для импорта данных из бинарных дампов PostgreSQL/Greenplum.
